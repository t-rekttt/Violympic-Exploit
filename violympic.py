#!/usr/bin/env python
# -*- coding: utf-8 -*-
import requests, find, json, time, random, hashlib

print("By T-Rekt of J2TeaM")
print("THIS SNIPPET IS FOR EDUCATIONAL PURPOSE, PLEASE DO NOT ABUSE. OTHERWISE YOU MAY GET BANNED")
username = raw_input('Username: ')
password = raw_input('Password: ')

ldata = {
    'login_username':username,
    'login_password':password,
    }

def declare():
    session.headers = {
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        }

def press(a, b ,d, e, f): 
    f = a + '","' + b + '","' + d + '","' + e + '","' + f;
    f = pressl(f);
    a = f;
    b = "";
    for c in range(0,len(a)):
        f = '0.j2t'[0: 5]
        b += f + a[c];
    return b

def pressl(a):
    return a[::-1]

def presst(a, b):
    c=a
    d=''
    for e in range(0,len(c)):
    	f = '0.aaaaaaaaaaaaaaaaaaaaaaaaaa'[0: b]
    	d = d + (f + c[e])
    return d

def get_data(ran):
    session.headers = {
        'Content-Type': 'application/json'
        }
    data = {
        'local':0,
        'ran':ran
        }
    d = json.loads(session.post('http://violympic.vn/urlData.aspx/getdata',data=json.dumps(data)).text)['d']
    if d != None:
        return json.loads(d)
    return 0    

def start_working(a):
    play = session.get('http://violympic.vn/Play.aspx?ran='+a)
    round_key = find.find_between(play.text,'Exam.aspx?ran=',"'")
    return round_key

def start_login():
    login = session.post('http://violympic.vn/Login.aspx',data=ldata)
    if 'Set-Cookie' in login.headers:
        return 1
    return 0

def release_my_quiz_power():
    print('Trying to pass test: '+d['game_name_language'])
    session.get('http://violympic.vn/Timer.aspx?start=1&which_exam='+str(which_exam))
    print('Sleeping 60s')
    time.sleep(60)
    encrypted = press(str(userId),str(which_exam),str(totalPoint),subPoint,ran)
    postdata = {
        "local":0,
        "userId":userId,
        "which_exam":which_exam,
        "Token":encrypted,
        "totalPoint":totalPoint,
        "subPoint":subPoint,
        "ran":ran,
        "signature":signature_txt,
        "token_clinet":token_clinet_txt,
        "timeStop":"600",
        }
    finish = session.post('http://violympic.vn/SubmitTotalPoint.aspx/SendtotalPoint',data=json.dumps(postdata)).text
    url = find.find_between(finish,'ran=','"')
    session.get('http://violympic.vn/Play.aspx?ran='+url)
    return finish

def release_my_ultimate_power():
    print('Trying to pass fill-in game')
    aaa = '15585:[0a20fdbc52b6020a7bbc7d0ab069cbce]15917:[e30a84a4eeaaea5fad5cfe7e49cb498b]15918:[b7be71203343d9b7de711bd45bbe6388]15921:[f4549093388c99a4d8c1cf5ccbdbc09b]15920:[adc317b92823ad277baed6c64349e748]15926:[a4e7a49bcbd1b581f017dec5fbface04]15919:[fbfd1095bf7217f2e28e0f5458827905]15916:[a4e7a49bcbd1b581f017dec5fbface04]15925:[b7be71203343d9b7de711bd45bbe6388]15913:[d35ce0f1ff3321cc39b4fa8b52412196]15912:[c93fb6a1101959818ecea33d15418dda]15923:[e30a84a4eeaaea5fad5cfe7e49cb498b]'
    which_round = d['which_round']
    block = d['block']
    key = 0
    doneexam = which_exam
    result = session.get('')
    
session = requests.session()
declare()
if start_login():
    print('Login successfully')
    while (1>0):        
        get_round = session.get('http://violympic.vn/Round.aspx')
        round_id = find.find_between(get_round.text,'Play.aspx?ran=',"'")
        #print(round_id)
        session.get('http://violympic.vn/EnKey.aspx?type=entekey&input=QVDECC3EC3')
        round_key = start_working(round_id)
        d = get_data(round_key)
        if d:
            print('Starting a new test')
            session.get('http://violympic.vn/Exam.aspx?ran='+round_key)
            d = get_data(round_key)
            userId = d['userId']
            which_exam = d['which_exam']
            #Token = d['Token']
            signature_txt = d['signature']
            #token_clinet_txt = "ksjhjsf" + str(random.random())
            token_clinet_txt = "ksjhjsf0.8059151084418859"
            signature_txt = hashlib.md5(signature_txt+token_clinet_txt).hexdigest()
            totalPoint = 100
            subPoint = '20,20,20,20,20'
            ran = d['ran']
            if d['game_name_language']!=None:
                result = release_my_quiz_power()
                if (which_exam==3):
                    print('Well, you are going to pass the round, you know?')
                    session.get('http://violympic.vn/Round.aspx')
                    break
                    #time.sleep(15)
                print('Test passed\n')
            else:
                release_my_ultimate_power()
                #print('I need your ultimate power')
                break
        else:
            print('Error')
            break
